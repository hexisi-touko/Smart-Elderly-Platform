第五章 数据库设计
5.1 数据库设计原则
本章围绕智能家居养老平台“健康管理、安全应急、生活照料、精神慰藉”四大核心功能，遵循以下设计原则构建数据库架构，确保数据存储的完整性、安全性、扩展性与性能适配性：
业务适配原则：精准覆盖全业务场景，实体与表结构严格对齐服务流程，支撑应急处置、服务预约结算、健康数据追溯等核心业务闭环，无冗余或缺失数据节点。
数据安全原则：采用隐私数据加密、逻辑删除、权限管控三重策略，契合养老场景下老人隐私保护、历史数据留存（如健康记录、财务流水）的核心需求，符合数据安全法规要求。
性能优化原则：通过索引设计、分表策略、冷热数据分离，适配万级并发用户、1000条/秒设备数据采集的高并发需求，保障海量数据场景下的查询与存储效率。
可扩展原则：预留第三方接口对接字段、个性化配置节点，支持智能设备迭代、服务模式拓展（如线上文娱、跨机构体检），适配平台长期运营与功能升级需求。
5.2 实体与关系设计
5.2.1 核心实体梳理
基于平台业务流程，梳理18类核心实体，覆盖用户、服务、设备、数据四大维度，补充此前缺失的精神慰藉、健康管理延伸场景实体，具体如下表所示：
5.2.2 实体关系定义
基于业务逻辑，定义1:1、1:N、N:M三类实体关系，通过中间表优化N:M关系，消除数据冗余，同时采用“物理外键+逻辑删除”策略，保障数据完整性与历史数据留存，具体关系如下：
1. 1:1关系
适用于一对一绑定、数据精准关联场景，确保信息唯一性与可追溯性：
服务订单（ServiceOrder）与支付记录（PaymentRecord）：一个订单对应一条支付记录，支撑订单结算与对账闭环，关联字段为order_id。
服务订单（ServiceOrder）与服务评价（ServiceEvaluation）：一个订单对应一条评价，仅订单完成后可创建，关联字段为order_id。
系统用户（SystemUser）与角色（Role）：一个用户对应一个核心角色，明确操作权限范围，关联字段为role_id。
2. 1:N关系
适用于主实体关联多个从实体场景，支撑数据批量关联与管理：
老人（Elderly）与健康记录（HealthRecord）：一位老人对应多条健康记录，关联字段为elderly_id，支撑个人健康数据追溯。
老人（Elderly）与智能设备（SmartDevice）：一位老人可绑定多台智能设备，关联字段为elderly_id，支持设备换绑与数据汇总。
服务商（ServiceProvider）与服务项目（ServiceItem）：一个服务商可提供多项服务，关联字段为provider_id，支撑服务资源分类管理。
安全预警（SafetyAlert）与服务人员（ServiceStaff）：一条预警可分配多位服务人员处置，关联字段为alert_id，支撑协同应急。
3. N:M关系（中间表优化）
通过中间表拆解多对多关系，避免数据冗余，提升关系灵活性：
老人（Elderly）与监护人（Guardian）：新增中间表t_elderly_guardian，关联双方ID，支持一位老人对应多位监护人、一位监护人关联多位老人。
服务订单（ServiceOrder）与服务人员（ServiceStaff）：新增中间表t_order_staff，关联双方ID，支持多人协作完成同一订单服务。
老人（Elderly）与线上课程（OnlineCourse）：新增中间表t_elderly_course，关联双方ID，记录报名状态与学习进度，支持一人报名多门课程。
老人（Elderly）与线下活动（OfflineActivity）：新增中间表t_activity_enrollment，关联双方ID，记录报名与签到状态，支撑活动核销管理。
老人（Elderly）与慢病类型：新增中间表t_elderly_chronic，关联elderly_id与chronic_type，支持一位老人记录多种慢病类型。
5.3 表结构设计
基于实体关系设计，细化各核心表字段、类型、约束与索引，优化冗余字段与逻辑设计，补充缺失表结构，确保适配全业务场景与数据安全需求。核心表结构如下（仅列关键字段，通用字段如id、create_time、update_time、is_deleted默认包含）：
5.3.1 用户维度核心表
t_elderly（老人表）
t_elderly_chronic（老人慢病关联表）
5.3.2 设备与健康数据核心表
t_smart_device（智能设备表）
t_health_record（健康记录表）
索引设计：新增复合索引（elderly_id+collect_time+record_type），优化老人健康数据按时间范围、类型查询的效率；新增单字段索引（data_source），适配医院同步数据批量查询场景。
t_safety_alert（安全预警记录表）
索引设计：新增复合索引（alert_time+alert_status），优化应急处置中“按时间查询未处理预警”的高频操作效率；新增单字段索引（emergency_order_id），适配急救系统数据同步查询。
5.3.3 服务与订单核心表
t_service_order（服务订单表）
索引设计：新增复合索引（provider_id+order_status+service_time），支撑服务商查询待接单订单、按时间统计服务量的需求；新增单字段索引（elderly_id+order_status），优化老人订单追溯效率。
t_payment_record（支付记录表）
5.3.4 权限与审计核心表
t_role（角色表）
t_role_permission（角色权限关联表）
t_service_provider（服务商表）
t_service_staff（服务人员表）
t_service_evaluation（服务评价表）
t_health_threshold（健康阈值表）
5.4 数据库性能与安全设计
5.4.1 性能优化设计
1. 分表与数据存储策略
采用按时间分表策略，对高频写入、海量存储的表进行拆分：健康记录表（t_health_record）、安全预警表（t_safety_alert）按年度分表（如t_health_record_2026），历史数据（超过1年）迁移至冷存储，当前数据留存热存储；分表路由通过中间件实现，按collect_time/alert_time自动路由至对应分表，提升查询与写入效率。
同时，对t_health_threshold（健康阈值表）采用Redis缓存机制，将高频访问的阈值数据加载至缓存，减少数据库查询压力，缓存更新策略为“修改后主动更新+定时同步”，确保数据一致性。
2. 索引优化补充
在核心表现有索引基础上，补充以下索引，适配高频业务场景：
t_system_log（系统日志表）：新增复合索引（operate_time+operator_id），优化特定人员操作记录追溯效率。
t_physical_exam_reservation（体检预约表）：新增复合索引（elderly_id+reservation_time），优化老人体检预约查询。
t_online_course（线上课程表）：新增单字段索引（course_type），优化课程分类查询。
5.4.2 安全设计
1. 隐私数据保护
对身份证号、手机号、银行卡号等敏感数据，采用AES加密算法存储，加密密钥定期轮换（每季度一次），密钥存储于独立密钥管理系统，避免与数据库同库存储；健康数据按权限分级管控，子女仅可查看本人父母数据，监管人员需申请授权后查看，运营人员无敏感数据查看权限，通过t_role_permission表精准控制。
2. 数据备份与恢复
采用“每日增量备份+每周全量备份”策略，备份文件异地存储（主备机房距离≥50公里），备份完成后通过backup_flag字段标记，避免重复备份或遗漏；故障恢复时，优先通过增量备份恢复至最近时间点，配合全量备份补全数据，确保故障恢复时间≤1小时，核心数据（健康记录、订单流水）备份留存时间≥3年。
3. 操作审计与异常监控
t_system_log表全面记录系统操作，包含操作人员、操作时间、操作内容、IP地址、操作结果，支撑操作追溯；新增异常登录预警机制，对同一账号多次密码错误、异地登录等场景触发预警，记录至系统日志并通知管理员，防范账号被盗风险。
5.5 数据库扩展性设计
5.5.1 第三方接口对接适配
在核心表中预留第三方接口关联字段，支撑后续对接拓展：除已新增的emergency_order_id（急救系统）、third_party_org_id（体检机构）、transaction_id（第三方支付）外，可在t_smart_device表新增third_party_device_id（第三方设备平台ID），适配多厂商设备接入；在t_health_record表新增third_party_sync_id（医院同步标识），确保诊疗数据同步一致性。
5.5.2 功能拓展适配
预留服务模式拓展空间，如新增“上门体检”服务时，可复用t_physical_exam_reservation表，通过third_party_org_id关联体检机构，无需新增核心表；支持设备类型迭代，t_smart_device表通过device_type字段适配新增设备（如智能床垫、心电监测仪），仅需扩展record_type字段枚举值，无需修改表结构。
5.6 本章小结
本章基于智能家居养老平台核心业务，完成了实体关系、表结构、性能安全及扩展性的全维度数据库设计，重点补充了应急处置
优化后的数据库设计，既保障了数据存储的完整性、安全性与性能，又适配平台当前核心功能与未来拓展需求，能有效支撑健康管理、安全应急、生活照料、精神慰藉四大模块的业务落地，为平台稳定运行提供坚实的数据支撑。
|（注：文档部分内容可能由 AI 生成)
